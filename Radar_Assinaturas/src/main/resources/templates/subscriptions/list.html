<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Assinaturas</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
      .container { max-width: 900px; margin: 0 auto; padding: 24px; }
      .actions { display:flex; gap:12px; margin-bottom:16px; }
      table { width:100%; border-collapse: collapse; }
      th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
      thead th { background: #f7f9fc; }
      .btn { display:inline-block; padding:8px 12px; border-radius:6px; border:1px solid #ccc; text-decoration:none; color:#333; }
      .btn-primary { background: var(--primary); color:#fff; border-color: var(--primary); }
      .btn-danger { background: #d4380d; color:#fff; border-color: #d4380d; }
    </style>
    <!-- Reintrodução gradual de Thymeleaf: nome e ações com guardas -->
</head>
<body>
<div class="container">
    <h1>Assinaturas</h1>
    <div class="actions">
        <a class="btn btn-primary" th:href="@{/subscriptions/new}">Cadastrar Assinatura</a>
        <a class="btn" th:href="@{/}">Voltar ao Dashboard</a>
    </div>

    <table>
        <thead>
        <tr>
            <th>Nome</th>
            <th>Preço</th>
            <th>Frequência</th>
            <th>Categoria</th>
            <th>Renovação</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${subscriptions} == null or ${#lists.isEmpty(subscriptions)}">
            <td colspan="6">Nenhuma assinatura cadastrada.</td>
        </tr>
        <tr th:each="s : ${subscriptions}">
            <td th:text="${s.name}">-</td>
            <td th:text="${s.price != null ? 'R$ ' + #numbers.formatDecimal(s.price, 1, 'POINT', 2, 'COMMA') : '-'}">-</td>
            <td th:text="${s.frequency != null ? (#messages.msgOrNull('frequency.' + s.frequency.name()) != null ? #messages.msgOrNull('frequency.' + s.frequency.name()) : s.frequency.name()) : '-'}">-</td>
            <td th:text="${s.category != null ? (#messages.msgOrNull('category.' + s.category.name()) != null ? #messages.msgOrNull('category.' + s.category.name()) : s.category.name()) : '-'}">-</td>
            <td th:text="${s.renewalDate != null ? #temporals.format(s.renewalDate, 'dd/MM/yyyy') : '-'}">-</td>
            <td>
                <a class="btn" th:if="${s.id} != null" th:href="@{/subscriptions/{id}/edit(id=${s.id})}">Editar</a>
                <form th:if="${s.id} != null" th:action="@{/subscriptions/{id}/delete(id=${s.id})}" method="post" style="display:inline">
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
                <span th:if="${s.id} == null">Salvar para habilitar ações</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>